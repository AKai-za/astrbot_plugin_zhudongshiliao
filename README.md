# 自动私聊插件

## 插件简介

这是一个为 AstrBot 设计的工具插件，提供私聊功能作为工具供大模型调用。插件采用工具模式，由大模型自己判断何时使用，确保人格一致性。

## 核心功能

- **私聊消息**：大模型可以向指定用户发送私聊消息
- **管理员消息**：大模型可以向管理员发送消息
- **告状功能**：大模型可以向管理员发送告状消息（支持开关控制）
- **管理员信息**：大模型可以获取当前管理员配置信息

## 安装方法

1. 下载插件到 AstrBot 的插件目录：
   ```
   d:\Astrbot\AstrBot\data\plugins\
   ```

2. 确保插件目录结构如下：
   ```
   astrbot_plugin_zhudongshiliao/
   ├── main.py          # 插件主文件
   ├── _conf_schema.json  # WebUI配置文件
   ├── metadata.yaml    # 插件元数据
   └── README.md        # 本说明文件
   ```

3. 重启 AstrBot，插件会自动加载并注册工具

## 配置方法

插件支持通过 WebUI 进行配置：

1. 打开 AstrBot WebUI
2. 进入「插件管理」页面
3. 找到「自动私聊插件」并点击「管理」
4. 修改配置项：
   - **管理员ID**：设置接收消息和告状的管理员QQ号
   - **启用告状**：开启或关闭告状功能

## 使用方式

插件会自动注册为大模型的工具，大模型会根据对话内容和上下文，自主决定何时使用这些工具：

- 当需要发送私聊消息时，大模型会调用 `private_message` 工具
- 当需要向管理员报告事情时，大模型会调用 `message_to_admin` 工具
- 当需要告状时，大模型会调用 `sue_to_admin` 工具
- 当需要获取管理员信息时，大模型会调用 `get_admin_info` 工具

## 工作原理

1. **消息触发**：用户在群聊中发送消息
2. **大模型处理**：AstrBot 将消息传递给大模型
3. **大模型决策**：大模型分析消息内容，决定是否需要使用私聊工具
4. **工具调用**：大模型调用相应的工具
5. **执行操作**：插件执行消息发送操作
6. **静默处理**：工具执行后保持静默，不干扰正常对话

## 版本更新

### v0.2.0
- 新增群消息发送功能，支持事件回复、平台API和上下文发送
- 改进群消息发送的可靠性并增加多种发送方式
- 统一不同发送方式下的成功返回信息，添加数字后缀以区分不同发送路径
- 现在可以私聊-私聊，群发-私聊，私聊-发群。因为是工具所以可以配合其他插件使用(本人就试着在群里让她上网然后私发给我了，嗯没问题捏。有问题过来踢我谢谢)。

### v0.1.3
- 完全重写为工具模式，使用 `@filter.llm_tool` 装饰器注册工具
- 实现四个核心工具：私聊消息、管理员消息、告状、获取管理员信息
- 修复消息发送的类型错误
- 添加 `event.stop_event()` 防止消息重复发送
- 简化配置，支持WebUI实时修改

## 注意事项

1. 插件作为工具供大模型调用，不会主动处理消息
2. 大模型会根据对话内容自主决定是否使用私聊工具
3. 请在WebUI中设置正确的管理员ID，以便接收消息
4. 告状功能可以在WebUI中开启或关闭
5. 如遇到问题，请查看 AstrBot 的日志文件获取详细信息

## 联系方式

- 作者：引灯续昼(2757808353)  交流群369907893
- 仓库：https://github.com/HLC2757808353/astrbot_plugin_zhudongshiliao

如有问题或建议，请直接和我说喵，因为本人很菜的，嗯真的qaq。