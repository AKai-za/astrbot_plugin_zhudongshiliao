# 自动私聊插件 (astrbot_plugin_zhudongshiliao)

## 插件介绍

自动私聊插件是一个功能强大的 AstrBot 插件，当用户发送消息时自动进行私聊操作。支持群消息总结、错误信息转发、禁言检测通知等多种功能，为用户提供更加智能和灵活的消息处理能力。

## 主要功能

### 1. 自动私聊功能
- **关键词触发**：当用户发送包含特定关键词的消息时自动私聊
- **自然语言命令**：支持使用自然语言触发私聊，如"私聊我"、"私信我"等
- **管理员优先**：只有管理员可以触发私聊功能
- **智能回复**：集成LLM，为私聊消息添加智能思考和回复

### 2. 群消息总结
- **关键词触发**：当用户发送"总结"、"汇总"等关键词时自动总结群消息
- **私聊发送**：将总结结果通过私聊发送给用户
- **智能总结**：使用LLM生成高质量的群消息总结

### 3. 错误信息转发
- **自定义格式**：支持自定义错误信息格式
- **指定接收人**：可指定错误信息发送给特定用户
- **自动检测**：当发生错误时自动发送错误信息

### 4. 禁言检测与通知
- **自动检测**：当机器人在群中被禁言时自动检测
- **管理员通知**：向管理员发送详细的禁言通知
- **智能处理**：被禁言后自动屏蔽该群消息，避免重复错误

### 5. 群员汇报功能
- **关键词触发**：当群员说"告诉你创造者"、"告诉开发者"等关键词时
- **内容提取**：自动提取关键词后的内容作为汇报内容
- **管理员通知**：将汇报内容通过私聊发送给管理员

### 6. 管理员功能
- **管理员检测**：支持检测用户是否为管理员
- **权限控制**：只有管理员可以执行大部分操作
- **配置管理**：管理员可通过WebUI管理插件配置

## 配置选项

### WebUI 配置

插件提供了直观的 WebUI 配置界面，可在 AstrBot 管理面板中进行配置：

| 配置项 | 描述 | 默认值 |
|--------|------|--------|
| admin_list | 管理员ID列表 | ["2757808353"] |
| private_keywords | 私聊触发关键词 | ["私聊", "私信", "私发", "发给我"] |
| summary_keywords | 群消息总结触发关键词 | ["总结", "汇总", "总结一下"] |
| report_keywords | 群员汇报触发关键词 | ["告诉你创造者", "告诉开发者"] |
| error_format | 错误信息格式，支持 {method}、{error} 占位符 | "【错误信息】\n方法: {method}\n错误: {error}" |
| report_status | 是否在群里汇报发送状况 | false |
| private_send_id | 私发ID，所有私发消息都会发给这个ID | "" |

### 配置文件

插件会在首次运行时自动创建 `config.json` 配置文件，包含所有配置选项。

## 使用示例

### 1. 触发私聊功能

```
幽幽，你私聊我看看
```

### 2. 触发群消息总结

```
幽幽，总结一下最近的消息
```

### 3. 群员汇报

```
幽幽，告诉你创造者 我发现了一个问题
```

### 4. 禁言检测

当机器人在群中被禁言时，会自动向管理员发送禁言通知。

## 常见问题

### 1. 插件不响应消息

**解决方案**：
- 确保您的用户ID在管理员列表中
- 检查插件是否正确初始化（查看日志）
- 尝试重启 AstrBot

### 2. 私聊功能不生效

**解决方案**：
- 确保使用了正确的关键词（如"私聊"、"私信"等）
- 检查管理员配置是否正确
- 查看插件日志确认是否触发了私聊功能

### 3. 禁言通知不发送

**解决方案**：
- 确保机器人确实被禁言
- 检查管理员列表配置
- 查看插件日志确认是否检测到禁言事件

### 4. 群员汇报功能不生效

**解决方案**：
- 确保使用了正确的关键词（如"告诉你创造者"）
- 检查管理员列表配置
- 查看插件日志确认是否触发了汇报功能

## 日志说明

插件提供了详细的日志信息，可通过 AstrBot 日志系统查看：

- **INFO**：正常操作信息，如插件初始化、功能触发等
- **DEBUG**：调试信息，包括消息处理、关键词检测等
- **WARNING**：警告信息，如禁言检测、配置问题等
- **ERROR**：错误信息，包括详细的错误堆栈

## 版本历史

### v1.4.0
- 完全重构插件代码，简化结构
- 集成LLM，为所有功能添加智能思考和回复
- 改进禁言检测逻辑，通过错误捕获自动检测禁言事件
- 增强群员汇报功能，支持更多关键词
- 优化消息处理，支持关键词在句子中的任何位置
- 添加详细的日志输出，便于调试
- 修复配置同步问题，确保WebUI配置立即生效

### v1.2.2
- 修复 send_error_message 方法代码重复问题
- 实现实时配置获取功能，解决 WebUI 配置同步问题
- 增强私聊功能，支持自然语言命令
- 添加昵称到ID解析功能
- 修复 report status toggle 功能
- 修复 summary 功能
- 添加管理员检测功能

### v1.2.1
- 优化消息发送逻辑
- 增加错误处理
- 完善日志系统

### v1.2.0
- 初始版本发布
- 实现基本私聊功能
- 实现群消息总结功能
- 实现错误信息转发功能

## 技术说明

### 插件架构

- **事件驱动**：基于 AstrBot 的事件驱动架构
- **异步编程**：使用 Python 异步编程提高性能
- **实时配置**：实时从WebUI获取配置，确保更改立即生效
- **用户缓存**：自动缓存用户信息，提高处理效率
- **LLM集成**：使用大模型生成智能思考和回复

### 核心方法

- `send_private_message`：发送私聊消息
- `send_error_message`：发送错误信息
- `handle_summary_request`：处理群消息总结请求
- `handle_mute_event`：处理禁言事件
- `handle_report_request`：处理群员汇报请求
- `handle_private_request`：处理私聊请求
- `is_admin`：检测用户是否为管理员
- `call_llm`：调用大模型生成思考和回复

## 安装方法

1. 将插件文件夹 `astrbot_plugin_zhudongshiliao` 复制到 AstrBot 的 `data/plugins` 目录
2. 重启 AstrBot
3. 插件会自动初始化并创建配置文件
4. 在 AstrBot 管理面板中调整配置（可选）

## 注意事项

- 确保 AstrBot 版本 >= v4.0.0
- 首次运行时会自动创建配置文件，包含默认管理员ID
- 为了获得最佳体验，建议保持插件配置为默认值
- 当机器人被禁言时，会自动向管理员发送通知

## 联系与支持

如果您在使用过程中遇到问题，可通过以下方式获取支持：

- **GitHub Issues**：在插件仓库中提交 Issue
- **AstrBot 社区**：参与 AstrBot 社区讨论
- **开发者**：联系插件开发者获取技术支持

---

**插件名称**：自动私聊插件 (astrbot_plugin_zhudongshiliao)
**版本**：v1.4.0
**作者**：引灯续昼
**描述**：自动私聊插件，当用户发送消息时，自动私聊用户。支持群消息总结、错误信息转发、禁言检测通知等功能。